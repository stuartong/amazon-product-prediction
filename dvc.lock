schema: '2.0'
stages:
  load_data:
    cmd: python load_data.py
    deps:
    - path: load_data.py
      md5: 1d8771affb5f14d8f66712367fe680b2
      size: 3430
    params:
      params.yaml:
        load_data.cat_meta_url: http://deepyeti.ucsd.edu/jianmo/amazon/metaFiles2/meta_Appliances.json.gz
        load_data.cat_review_url: http://deepyeti.ucsd.edu/jianmo/amazon/categoryFiles/Appliances.json.gz
    outs:
    - path: data/prepared
      md5: 7870636af441f6a2358ac2b71ac57a47.dir
      size: 834301147
      nfiles: 2
  preprocess_products:
    cmd: python preprocess_products.py data/prepared
    deps:
    - path: data/prepared
      md5: 7870636af441f6a2358ac2b71ac57a47.dir
      size: 834301147
      nfiles: 2
    - path: preprocess_products.py
      md5: 744e6ac2b944ea41bec7931390324f43
      size: 2737
    params:
      params.yaml:
        preprocess_products:
          word2vec_features: true
          handpicked_features: true
          word2vec_model_name: glove-wiki-gigaword-300
          occurrence_threshold: 500
    outs:
    - path: data/products
      md5: 1b578030d5f2be4ff6ce39a5676d88f5.dir
      size: 876608673
      nfiles: 1
  preprocess_reviews:
    cmd: python preprocess_reviews.py data/prepared
    deps:
    - path: data/prepared
      md5: 7870636af441f6a2358ac2b71ac57a47.dir
      size: 834301147
      nfiles: 2
    - path: preprocess_reviews.py
      md5: f6d38c329571279b99496f1cc58f0389
      size: 1428
    outs:
    - path: data/reviews
      md5: e0866fe512426dbf79e2bd5ee359096b.dir
      size: 158450968
      nfiles: 1
  success_metrics:
    cmd: python create_success_metrics.py
    deps:
    - path: create_success_metrics.py
      md5: c37424c125e8f06833a1c8c2d34ce07c
      size: 1662
    - path: data/fake/fake_free_data
      md5: 93b696a442641d14d8d3fe7ea22488ef.dir
      size: 4822472
      nfiles: 2
    - path: data/products
      md5: 1b578030d5f2be4ff6ce39a5676d88f5.dir
      size: 876608673
      nfiles: 1
    - path: data/reviews
      md5: e0866fe512426dbf79e2bd5ee359096b.dir
      size: 158450968
      nfiles: 1
    params:
      params.yaml:
        success_metrics.cutoff: 2
        success_metrics.fake_free_data: false
    outs:
    - path: data/metrics
      md5: 1914681ee5f4661bf767999e031e4453.dir
      size: 877417162
      nfiles: 1
  supervised_model:
    cmd: python model_supervised.py data/metrics
    deps:
    - path: data/metrics
      md5: 1914681ee5f4661bf767999e031e4453.dir
      size: 877417162
      nfiles: 1
    - path: model_supervised.py
      md5: 2a4637e05683af02a4bd2cc8f84e6903
      size: 11831
    params:
      params.yaml:
        supervised_model.ada_base_iter:
        - 1
        - 3
        - 5
        supervised_model.ada_base_model: DecisionTreeClassifier
        supervised_model.ada_max_depth: 3
        supervised_model.best_k: 1000
        supervised_model.cluster_features: true
        supervised_model.gscv: false
        supervised_model.model_type: LogisticRegression
        supervised_model.n_jobs: -1
        supervised_model.oversample: false
        supervised_model.param_dict:
          learning_rate:
          - 0.005
          - 0.01
          - 0.015
          subsample:
          - 0.5
          - 0.8
          n_estimators:
          - 1200
          - 1300
          - 1400
          max_depth:
          - 8
        supervised_model.params:
          random_state: 42
          C: 0.000954095476
          penalty: l2
          solver: saga
        supervised_model.pca: true
        supervised_model.pca_n_components: 55
        supervised_model.scale: true
        supervised_model.split: 0.8
        tfidf_product_success.max_df: 0.7
        tfidf_product_success.min_df: 0.05
    outs:
    - path: model/product_success/
      md5: 8fbb5b2b1f4490e9b5edd5afe32807fa.dir
      size: 13427994
      nfiles: 7
  evaluate_supervised:
    cmd: python evaluate_supervised.py prdct_supervised_report.json
    deps:
    - path: evaluate_supervised.py
      md5: 899cdad2458e962d5164f06ca29cbb2b
      size: 7544
    - path: model/product_success/
      md5: 8fbb5b2b1f4490e9b5edd5afe32807fa.dir
      size: 13427994
      nfiles: 7
    params:
      params.yaml:
        evaluate_supervised.X_test: model/product_success/X_test.npy
        evaluate_supervised.X_train: model/product_success/X_train.npy
        evaluate_supervised.X_val: model/product_success/X_val.npy
        evaluate_supervised.clf: model/product_success/model.pkl
        evaluate_supervised.f1_avg: weighted
        evaluate_supervised.y_test: model/product_success/y_test.npy
        evaluate_supervised.y_train: model/product_success/y_train.npy
        evaluate_supervised.y_val: model/product_success/y_val.npy
    outs:
    - path: prdct_supervised_report.json
      md5: 4c6020f38dd5ceda6789aee8b043df2d
      size: 3291
  prepare_fake_labeled_model:
    cmd: python load_prepare_fake_labeled_data.py
    deps:
    - path: data/fake/labeled_data/amazon_reviews_labeled.txt
      md5: ec3f2c1ef9598b56c38fbc00c0ac90de
      size: 8404357
    - path: load_prepare_fake_labeled_data.py
      md5: 27bf5d2e1665a1c3ae06a55f960c3d2d
      size: 1759
    params:
      params.yaml:
        fake_review_labeled_file_path: data/fake/labeled_data/amazon_reviews_labeled.txt
        load_prepare_fake.features:
          word2vec_features: true
          handpicked_features: true
        load_prepare_fake.word2vec_model_name: glove-wiki-gigaword-300
    outs:
    - path: data/fake/training/labeled_processed.pkl
      md5: a47919a26eae77a09ac3a3f27afdb403
      size: 70775394
  fd_supervised_model:
    cmd: python fake_detection_model.py data/fake/training/
    deps:
    - path: data/fake/training/
      md5: 466b9e866bd31e9406c7890d34ea576a.dir
      size: 70775394
      nfiles: 1
    - path: fake_detection_model.py
      md5: 0747d207c07f2400772805d6a46ae2af
      size: 12126
    params:
      params.yaml:
        fd_supervised_model.ada_base_iter:
        - 2
        - 8
        - 10
        fd_supervised_model.ada_base_model: DecisionTreeClassifier
        fd_supervised_model.ada_max_depth: 3
        fd_supervised_model.gscv: true
        fd_supervised_model.model_type: LogisticRegression
        fd_supervised_model.n_jobs: -1
        fd_supervised_model.oversample: true
        fd_supervised_model.param_dict:
          C:
          - 1e-05
          - 1.26185688e-05
          - 1.59228279e-05
          - 2.009233e-05
          - 2.53536449e-05
          - 3.19926714e-05
          - 4.03701726e-05
          - 5.09413801e-05
          - 6.42807312e-05
          - 8.11130831e-05
          - 0.000102353102
          - 0.000129154967
          - 0.000162975083
          - 0.000205651231
          - 0.000259502421
          - 0.000327454916
          - 0.00041320124
          - 0.000521400829
          - 0.000657933225
          - 0.000830217568
          - 0.00104761575
          - 0.00132194115
          - 0.00166810054
          - 0.00210490414
          - 0.00265608778
          - 0.00335160265
          - 0.00422924287
          - 0.00533669923
          - 0.00673415066
          - 0.00849753436
          - 0.0107226722
          - 0.0135304777
          - 0.0170735265
          - 0.0215443469
          - 0.0271858824
          - 0.0343046929
          - 0.0432876128
          - 0.0546227722
          - 0.068926121
          - 0.0869749003
          - 0.109749877
          - 0.138488637
          - 0.17475284
          - 0.220513074
          - 0.27825594
          - 0.351119173
          - 0.443062146
          - 0.559081018
          - 0.705480231
          - 0.890215085
          - 1.12332403
          - 1.41747416
          - 1.78864953
          - 2.25701972
          - 2.84803587
          - 3.59381366
          - 4.53487851
          - 5.72236766
          - 7.22080902
          - 9.11162756
          - 11.49757
          - 14.5082878
          - 18.3073828
          - 23.101297
          - 29.1505306
          - 36.7837977
          - 46.4158883
          - 58.5702082
          - 73.9072203
          - 93.2603347
          - 117.681195
          - 148.496826
          - 187.381742
          - 236.448941
          - 298.364724
          - 376.493581
          - 475.081016
          - 599.48425
          - 756.463328
          - 954.548457
          - 1204.50354
          - 1519.91108
          - 1917.91026
          - 2420.12826
          - 3053.85551
          - 3853.52859
          - 4862.60158
          - 6135.90727
          - 7742.63683
          - 9770.09957
          - 12328.4674
          - 15556.7614
          - 19630.4065
          - 24770.7636
          - 31257.1585
          - 39442.0606
          - 49770.2356
          - 62802.9144
          - 79248.2898
          - 100000.0
          penalty:
          - l1
          - l2
          random_state:
          - 42
          solver:
          - saga
        fd_supervised_model.params: None
        fd_supervised_model.pca: true
        fd_supervised_model.pca_n_components: 100
        fd_supervised_model.scale: true
        fd_supervised_model.split: 0.8
        fd_supervised_model.tfidf: true
        tfidf_fake_review.max_df: 0.7
        tfidf_fake_review.min_df: 0.05
    outs:
    - path: model/fake/
      md5: 166d5b44f4cba6dd3feef6fd5fcabdea.dir
      size: 16688562
      nfiles: 10
  fd_evaluate_supervised:
    cmd: python fd_evaluate_supervised.py fd_supervised_report.json
    deps:
    - path: fd_evaluate_supervised.py
      md5: 2ac32cf895ad1f7f7607cb9033e0e509
      size: 8912
    - path: model/fake/
      md5: 166d5b44f4cba6dd3feef6fd5fcabdea.dir
      size: 16688562
      nfiles: 10
    params:
      params.yaml:
        fd_evaluate_supervised.f1_avg: weighted
    outs:
    - path: fd_supervised_report.json
      md5: deb703f89b929cb28e1c5c8948c7d4f9
      size: 3139
  predicting_fake_reviews:
    cmd: python fd_test_model.py
    deps:
    - path: data/prepared/
      md5: 7870636af441f6a2358ac2b71ac57a47.dir
      size: 834301147
      nfiles: 2
    - path: fd_test_model.py
      md5: 3908b289b15b750b66680aa8878c6330
      size: 5837
    - path: model/fake
      md5: 166d5b44f4cba6dd3feef6fd5fcabdea.dir
      size: 16688562
      nfiles: 10
    params:
      params.yaml:
        fd_test_stage:
          tfidf_path: model/fake/tfidf_fitted_model.pkl
          pca_fitted_path: model/fake/pca_fitted_model.pkl
          scaler_fitted_path: model/fake/scaler_fitted_model.pkl
          model_fitted: model/fake/model.pkl
    outs:
    - path: data/fake/fake_free_data/
      md5: 93b696a442641d14d8d3fe7ea22488ef.dir
      size: 4822472
      nfiles: 2
  clustering_reviews:
    cmd: python clustering_reviews.py
    deps:
    - path: clustering_reviews.py
      md5: 2d112073792df83cb98a0db123c001b5
      size: 6882
    - path: data/fake/fake_free_data/fake_free_reviews.npy
      md5: d943f5b39b67ab3adf6752f949563bda
      size: 2411236
    - path: data/prepared/reviews.pkl
      md5: 463092a59a2edcaab5661372f71e06e9
      size: 196417016
    - path: data/reviews/reviews.pkl
      md5: 141a6cfd714b0751690b16a731ca2ce6
      size: 158450968
    params:
      params.yaml:
        clustering_model:
          data_source: fake_free
          model_type: KMeans
          params: None
          raw_data_params:
            tfidf_params:
              min_df: 0.05,
              max_df: 0.7,
              stop_words: english
              ngram_range: (1,2)
            scale: true
            reducer:
              name: PCA
              n_components: 3
              random_state: 42
          preprocessed_params:
            scale: true
            reducer:
            name: PCA
            n_components: 3
            random_state: 42
          fake_free_params:
            scale: true
            reducer:
            name: PCA
            n_components: 3
            random_state: 42
